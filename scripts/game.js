function BinaryHeap(a){this.content=[],this.scoreFunction=a}var gameData={};gameData.FAMILIES={unit:0,building:1,land:2,research:3},gameData.ELEMENTS=[[],[],[],[]],gameData.BASECAMPS=[],gameData.RANKS={me:0,ally:1,neutral:2,enemy:3},gameData.PLAYER_STATUSES={ig:0,defeat:1,victory:2,watcher:3,surrender:4},gameData.ELEMENTS_FLAGS={nothing:0,moving:1,attacking:2,mining:3,dying:5,building:6},gameData.unitId=0,gameData.createUniqueId=function(a){return this.unitId+=1,parseInt("1"+a+this.unitId)},gameData.Building=function(a,b,c,d,e){this.f=gameData.FAMILIES.building,this.id=gameData.createUniqueId(this.f),this.t=a.t,this.o=d,this.r=a.r,this.p={x:b,y:c},this.fl=0,this.cp=e?100:0,this.rp=null,this.q=[],this.qp=0,this.fr=0,this.l=a.l,this.a=null,this.toJSON=function(){return this}},gameData.Game=function(){this.stats=[],this.players=[],this.grid=[],this.gameElements={land:{},building:{},unit:{}},this.newBuildings=[],this.cancelBuildings=[],this.cancel=[],this.orders=[],this.modified=[],this.added=[],this.removed=[],this.chat=[],this.iterate=-1,this.update=function(){this.iterate=this.iterate>100?0:this.iterate+1;var a=gameLogic.update(this);return a}},gameData.Map=function(a,b,c,d,e){this.t=a,this.size=b,this.ve=c,this.ir=d,this.objectives=e},gameData.Order=function(a,b,c,d){this.type=a,this.moveTo=b,this.id=c,this.info=d,this.toJSON=function(){var a=null;return null!=this.moveTo&&(a={x:this.moveTo.x,y:this.moveTo.y}),{type:this.type,moveTo:a,id:this.id,info:this.info}}},gameData.Player=function(a,b,c,d){this.pid=a,this.o=b,this.r=c,this.n="",this.re=[],this.ra=[],this.s=gameData.PLAYER_STATUSES.ig,this.tec=[],this.tecC=[],this.pop={max:0,current:0},this.ai=!1,"undefined"!=typeof d&&d&&(this.ai=!0);for(var e in gameData.BASECAMPS[this.r].buildings){var f=gameData.BASECAMPS[this.r].buildings[e];f.pop>0&&(this.pop.max+=f.pop)}for(var e in gameData.BASECAMPS[this.r].units){var g=gameData.BASECAMPS[this.r].units[e];g.pop>0&&(this.pop.current+=g.pop)}},gameData.Terrain=function(a,b,c){this.f=gameData.FAMILIES.land,this.id=gameData.createUniqueId(this.f),this.t=a.t,this.r=0,this.p={x:b,y:c},this.sta=a.sta,this.ra=a.ra,this.toJSON=function(){return this}},gameData.Unit=function(a,b,c,d){this.f=gameData.FAMILIES.unit,this.id=gameData.createUniqueId(this.f),this.t=a.t,this.r=a.r,this.o=d,this.p={x:b,y:c},this.fl=0,this.a=null,this.pa=[],this.fr=0,this.ga=null,this.l=a.l,this.buff=[],this.toJSON=function(){var a=null;return null!=this.a&&(a=this.a.toJSON()),{id:this.id,f:this.f,t:this.t,r:this.r,o:this.o,p:{x:this.p.x,y:this.p.y},fl:this.fl,fr:this.fr,ga:this.ga,pa:this.pa,l:this.l,a:a}}};var AI={};AI.searchForNewResources=function(a,b,c){var d=tools.getNearestStuff(a,b,gameData.FAMILIES.land,c);null==d&&c==gameData.RESOURCES.wood.id&&(d=tools.getNearestStuff(a,b,gameData.FAMILIES.land,c,null,!0)),null!=d?b.a=new gameData.Order(action.ACTION_TYPES.gather,null,d.id,c):(b.a=null,b.pa=[],b.fl=gameData.ELEMENTS_FLAGS.nothing)},AI.searchForNewEnemy=function(a,b){var c=tools.getNearestStuff(a,b,gameData.FAMILIES.unit,null,gameData.RANKS.enemy);null==c&&(c=tools.getNearestStuff(a,b,gameData.FAMILIES.building,null,gameData.RANKS.enemy)),null!=c&&(b.a=new gameData.Order(action.ACTION_TYPES.attack,null,c.id))},AI.targetReaction=function(a,b,c){var d=tools.getElementData(b);if(d.isBuilder||d.range>1&&1==tools.getElementData(c).range){var e=tools.getFreeTilesAroundElements(a,b);if(e.length>0){var f=e[parseInt(Math.random()*(e.length-1))];b.a=new gameData.Order(action.ACTION_TYPES.move,f,null)}}else b.a=new gameData.Order(action.ACTION_TYPES.attack,null,c.id)};var action={};action.ACTION_TYPES={move:0,attack:1,gather:2,patrol:3,build:4,hold:5},action.BUILD_ACTION_SPEED=3,action.ATTACK_SPEED_CONSTANT=5,action.doTheBuild=function(a,b,c){c.cp<100?a.iterate%this.BUILD_ACTION_SPEED==0&&(production.updateConstruction(a,c),b.fl=gameData.ELEMENTS_FLAGS.building):c.l<tools.getElementData(c).l?a.iterate%this.BUILD_ACTION_SPEED==0&&(production.repairBuilding(a,c),b.fl=gameData.ELEMENTS_FLAGS.building):order.goToElementNextOrder(a,b)},action.doTheAttack=function(a,b,c){var d=tools.getElementData(b);if(a.iterate%(this.ATTACK_SPEED_CONSTANT-accessors.getStat(a.players,b.o,d,fightLogic.STATS_BUFF.attackSpeed))==0){var e=d.passiveSkill[fightLogic.PASSIVE_SKILLS.shootDelay];if(null!=e&&e.current>0)return void e.current--;fightLogic.attack(a,b,c),b.fl=gameData.ELEMENTS_FLAGS.attacking;var f=d.passiveSkill[fightLogic.PASSIVE_SKILLS.zone];if(null!=f){var g=tools.getTilesAround(a.grid,c.p,f,!0);for(var h in g)if(null!=g[h].c){var i=tools.getElementById(a,g[h].c);i.f!=gameData.FAMILIES.land&&fightLogic.attack(a,b,i)}}var j=d.passiveSkill[fightLogic.PASSIVE_SKILLS.suicide];null!=j&&(b.l-=j/100*d.l,tools.addUniqueElementToArray(a.modified,b));var k=d.passiveSkill[fightLogic.PASSIVE_SKILLS.poison];c.f==gameData.FAMILIES.unit&&null!=k&&(k.type=fightLogic.ACTIVE_BUFF.poison,c.buff.push(k))}},action.doTheGathering=function(a,b,c){a.iterate%tools.getElementData(b).gatheringSpeed==0&&(production.gatherResources(a,b,c),b.fl=gameData.ELEMENTS_FLAGS.mining)};var fightLogic={};fightLogic.WEAPON_TYPES={normal:0,piercing:1,siege:2,magic:3},fightLogic.ARMOR_TYPES={unarmored:0,light:1,medium:2,heavy:3,building:4},fightLogic.WEAPONS_EFFICIENCY=[[1,1,1.5,1,.4],[1.5,1.5,.5,.5,.2],[1.5,1,.5,.5,2],[1.5,1.5,1.5,1.5,.1]],fightLogic.STATS_BUFF={attack:0,defense:1,attackSpeed:2,speed:3,range:4,vision:5},fightLogic.ACTIVE_BUFF={poison:0},fightLogic.PASSIVE_SKILLS={poison:"poison",zone:"zone",suicide:"suicide",shootDelay:"shootDelay"},fightLogic.LANDS_MODIFIERS={highgrass:.5},fightLogic.attack=function(a,b,c){var d=tools.getElementData(b),e=tools.getElementData(c),f=this.WEAPONS_EFFICIENCY[d.weaponType][e.armorType],g=Math.max(0,parseInt(accessors.getStat(a.players,b.o,d,this.STATS_BUFF.attack)*f*(1+.2*Math.random()))-accessors.getStat(a.players,c.o,e,this.STATS_BUFF.defense));null!=a.grid[c.p.x][c.p.y].s&&(g*=fightLogic.LANDS_MODIFIERS[a.grid[c.p.x][c.p.y].s]),this.applyDamage(a,g,c,b),tools.addUniqueElementToArray(a.modified,c),c.f==gameData.FAMILIES.unit&&null==c.a&&AI.targetReaction(a,c,b),a.players[c.o].ra[b.o]=gameData.RANKS.enemy},fightLogic.applyDamage=function(a,b,c,d){c.l>0?(c.l-=b,c.l<=0&&(c.fl=gameData.ELEMENTS_FLAGS.dying,null!=d&&(d.fr=d.fr+1,d.a=null,tools.addUniqueElementToArray(a.modified,d),c.murderer=d.o,AI.searchForNewEnemy(a,d)),c.f==gameData.FAMILIES.building&&(production.removeBuilding(a,c),gameCreation.removeGameElement(a,c),delete a.gameElements.building[c.id]))):null!=d&&AI.searchForNewEnemy(a,d)};var gameCreation={};gameCreation.PROBABILITY_TREE=.6,gameCreation.ZONE_SIZE=12,gameCreation.createNewGame=function(a,b){var c=new gameData.Game;for(var d in b){var e=b[d];for(var f in a.ir.re)e.re.push(a.ir.re[f].value);for(var g in b)g==d?e.ra.push(gameData.RANKS.me):e.ra.push(gameData.RANKS.enemy);c.players.push(e)}return this.createNewMap(c,a,b),stats.init(c),c},gameCreation.createNewMap=function(a,b,c){if(a.grid=this.initGrid(b.size),b.t.id==gameData.MAP_TYPES.random.id)this.createRandomMap(a,b,c);else{var d=gameData.MAP_TYPES[Object.keys(gameData.MAP_TYPES)[b.t.id]].map;this.createMap(a,b,c,d)}},gameCreation.initGrid=function(a){for(var b=[],c=0;c<a.x;c++){b[c]=[];for(var d=0;d<a.y;d++)b[c][d]={c:0,x:c,y:d}}return b},gameCreation.createMap=function(a,b,c,d){var e=parseInt(b.size.x/d.length),f=[];for(var g in d)for(var h in d[g])d[g][h]==gameData.ZONES.basecamp?f.push([g,h]):this.populateZone(a,b,{x:g*e+1,y:h*e+1},{x:(parseInt(g)+1)*e-1,y:(parseInt(h)+1)*e-1},d[g][h]);for(var g in c){var i=parseInt(Math.random()*f.length),j=f[i],k={x:j[0]*this.ZONE_SIZE+parseInt(.5*this.ZONE_SIZE),y:j[1]*this.ZONE_SIZE+parseInt(.5*this.ZONE_SIZE)};this.setupBasecamp(a,c[g],k),f.splice(i,1)}},gameCreation.createRandomMap=function(a,b,c){for(var d=parseInt(b.size.x/this.ZONE_SIZE),e=parseInt(b.size.y/this.ZONE_SIZE),f=[],g=0;d>g;g++){f.push([]);for(var h=0;e>h;h++)f[g].push(-10)}this.dispatchPlayers(a,f,c,d,e);var i=[];for(var g in b.ve.zones)for(var j=b.ve.zones[g],k=0;k<j.factor;k++)i.push(j.t);for(var g=0;d>g;g++)for(var h=0;e>h;h++)f[g][h]<0?this.populateZone(a,b,{x:g*this.ZONE_SIZE,y:h*this.ZONE_SIZE},{x:(g+1)*this.ZONE_SIZE,y:(h+1)*this.ZONE_SIZE},i[parseInt(Math.random()*i.length)]):this.populateZone(a,b,{x:g*this.ZONE_SIZE,y:h*this.ZONE_SIZE},{x:(g+1)*this.ZONE_SIZE,y:(h+1)*this.ZONE_SIZE},f[g][h])},gameCreation.populateZone=function(a,b,c,d,e){switch(e){case gameData.ZONES.forest:this.createForest(a,c,d);break;case gameData.ZONES.goldmine:this.createGoldMine(a,b,c,d);break;case gameData.ZONES.gold:this.createWaterZone(a,b,c,d);break;case gameData.ZONES.highgrass:this.createHighGrass(a,b,c,d)}},gameCreation.createForest=function(a,b,c){for(var d=b.x;d<c.x;d++)for(var e=b.y;e<c.y;e++)Math.random()<this.PROBABILITY_TREE&&this.addGameElement(a,new gameData.Terrain(gameData.ELEMENTS[gameData.FAMILIES.land][0].tree,d,e))},gameCreation.createGoldMine=function(a,b,c,d){var e=gameData.ELEMENTS[gameData.FAMILIES.land][0].goldmine,f=this.getRandomPositionInZoneForElement(e,c,d);this.addGameElement(a,new gameData.Terrain(e,f.x,f.y))},gameCreation.createHighGrass=function(a,b,c,d){for(var e=c.x;e<d.x;e++)for(var f=c.y;f<d.y;f++)this.addGameElement(a,new gameData.Terrain(gameData.ELEMENTS[gameData.FAMILIES.land][0].highgrass,e,f))},gameCreation.createWaterZone=function(a,b,c,d){for(var e=c.x;e<d.x;e++)for(var f=c.y;f<d.y;f++)this.addGameElement(a,new gameData.Terrain(gameData.ELEMENTS[gameData.FAMILIES.land][0].gold,e,f))},gameCreation.getRandomPositionInZoneForElement=function(a,b,c){return{x:parseInt(b.x+a.shape[0].length/2+Math.random()*(c.x-b.x-a.shape[0].length)),y:parseInt(b.y+a.shape.length/2+Math.random()*(c.y-b.y-a.shape.length))}},gameCreation.addGameElement=function(a,b){var c=tools.getElementData(b),d=c.shape;a.gameElements[Object.keys(gameData.FAMILIES)[b.f]][b.id]=b;for(var e in d){var f=d[e];for(var g in f){var h=f[g];if(h>0&&(b.f!=gameData.FAMILIES.land||!c.canMoveIn)){var i=tools.getPartPosition(b,e,g);null!=a.grid[i.x]&&null!=a.grid[i.x][i.y]&&(a.grid[i.x][i.y].c=b.id)}else{var i=tools.getPartPosition(b,e,g);null!=a.grid[i.x]&&null!=a.grid[i.x][i.y]&&(a.grid[i.x][i.y].s=b.t)}}}tools.addUniqueElementToArray(a.added,b)},gameCreation.removeGameElement=function(a,b){var c=tools.getElementData(b),d=c.shape;for(var e in d){var f=d[e];for(var g in f){var h=f[g];if(h>0){var i=tools.getPartPosition(b,e,g);a.grid[i.x][i.y].c=0}}}tools.addUniqueElementToArray(a.removed,b)},gameCreation.dispatchPlayers=function(a,b,c,d,e){var f=this.getAvailableInitialPositions(c.length);for(var g in c){var h=parseInt(f.length*Math.random()),i=f[h];i={x:this.convertCoordinates(b[0].length,i.x),y:this.convertCoordinates(b.length,i.y)},f.splice(h,1),b[i.x][i.y]=gameData.ZONES.basecamp;var j={x:i.x*this.ZONE_SIZE+parseInt(this.ZONE_SIZE*(.25+.5*Math.random())),y:i.y*this.ZONE_SIZE+parseInt(this.ZONE_SIZE*(.25+.5*Math.random()))};this.setupBasecamp(a,c[g],j),this.placeZoneRandomlyAround(gameData.ZONES.forest,b,i.x,i.y),this.placeZoneRandomlyAround(gameData.ZONES.goldmine,b,i.x,i.y)}},gameCreation.placeZoneRandomlyAround=function(a,b,c,d){for(var e=null,f=null;null==e||1==b[e][f];)e=Math.min(b[0].length-1,Math.max(0,parseInt(c+2*Math.random()-1))),f=Math.min(b.length-1,Math.max(0,parseInt(d+2*Math.random()-1)));b[e][f]=a},gameCreation.setupBasecamp=function(a,b,c){var d=gameData.BASECAMPS[b.r],e=new gameData.Building(d.buildings[0],c.x,c.y,b.o,!0);this.addGameElement(a,e);var f=tools.getFreeTilesAroundElements(a,e);for(var g in d.units)this.addGameElement(a,new gameData.Unit(d.units[g],f[g].x,f[g].y,b.o))},gameCreation.getAvailableInitialPositions=function(a){var b=[];if(4!=a)for(var c=[[0,0,0],[0,1,0],[0,0,0]],d=0;a>d;d++){for(var e=null,f=null;null==e||c[e][f]>0;)e=parseInt(3*Math.random()),f=parseInt(3*Math.random());c[e][f]=1,b.push({x:e,y:f}),3>=a&&(2>e&&(c[e+1][f]=1),e>0&&(c[e-1][f]=1),2>f&&(c[e][f+1]=1),f>0&&(c[e][f-1]=1))}else Math.random()<.5?(b.push({x:0,y:0}),b.push({x:0,y:2}),b.push({x:2,y:0}),b.push({x:2,y:2})):(b.push({x:1,y:0}),b.push({x:1,y:2}),b.push({x:0,y:1}),b.push({x:2,y:1}));return b},gameCreation.convertCoordinates=function(a,b){return 0==b?1:1==b?parseInt(a/2):a-2};var gameLogic={};gameLogic.FREQUENCY=4,gameLogic.OFFLINE_FREQUENCY=4,gameLogic.AI_FREQUENCY=10,gameLogic.update=function(a){a.modified=[],a.added=[],a.removed=[];for(var b in a.orders)order.dispatchReceivedOrder(a,a.orders[b][0],a.orders[b][1]);a.orders=[];for(var c in a.players)a.players[c].s!=gameData.PLAYER_STATUSES.surrender&&(a.players[c].s=gameData.PLAYER_STATUSES.defeat),a.players[c].ai&&a.iterate%this.AI_FREQUENCY==0&&aiOrders.update(a,a.players[c]);for(var c in a.gameElements.unit){var d=a.gameElements.unit[c];this.resolveActions(a,d),this.updateMoves(a,d),this.protectAround(a,d);for(var e=d.buff.length;e--;){var f=d.buff[e];f.type==fightLogic.ACTIVE_BUFF.poison&&(d.l-=f.damage,d.buff.time--,0==d.buff.time&&d.buff.splice(e,1),tools.addUniqueElementToArray(a.modified,d))}}for(var c in a.gameElements.building){var d=a.gameElements.building[c];if(a.players[d.o].s!=gameData.PLAYER_STATUSES.surrender){var g=tools.getElementData(d);g.isProduction&&(a.players[d.o].s=gameData.PLAYER_STATUSES.ig)}this.updateBuildings(a,d),null!=tools.getElementData(d).attack&&(this.resolveActions(a,d),this.protectAround(a,d))}this.synchronizeActions(a),this.removeDeads(a),this.checkGameOver(a),stats.update(a);var h=[];for(var b in a.chat)h.push(a.chat[b]);return a.chat=[],{modified:a.modified,added:a.added,removed:a.removed,players:a.players,chat:h}},gameLogic.synchronizeActions=function(a){for(var b in a.newBuildings)a.newBuildings[b].l=1,gameCreation.addGameElement(a,a.newBuildings[b]);a.newBuildings=[];for(var b in a.cancelBuildings)gameCreation.removeGameElement(a,a.cancelBuildings[b]);a.cancelBuildings=[];for(var b in a.cancel){var c=a.cancel[b];production.cancel(a,c.building,c.index)}a.cancel=[]},gameLogic.updateMoves=function(a,b){null!=b.a&&null!=b.a.moveTo&&(move.moveElement(a,b,b.a.moveTo),tools.addUniqueElementToArray(a.modified,b))},gameLogic.resolveActions=function(a,b){if(null!=b.a&&null!=b.a.id){var c=tools.getElementById(a,b.a.id);if(null!=c){var d=tools.getElementData(b),e=tools.getElementsDistance(b,c);if(1==e)b.a.moveTo=null,b.fl=gameData.ELEMENTS_FLAGS.nothing,d.isBuilder&&c.f==gameData.FAMILIES.building&&rank.isAlly(a.players,b.o,c)?null!=b.ga?production.getBackResources(a,b):action.doTheBuild(a,b,c):d.isBuilder&&c.f==gameData.FAMILIES.land?action.doTheGathering(a,b,c):rank.isEnemy(a.players,b.o,c)&&action.doTheAttack(a,b,c);else if(e<=accessors.getStat(a.players,b.o,d,fightLogic.STATS_BUFF.range))rank.isEnemy(a.players,b.o,c)&&(b.a.moveTo=null,action.doTheAttack(a,b,c));else{var f=tools.getClosestPart(b,c);b.a.moveTo={x:f.x,y:f.y}}tools.addUniqueElementToArray(a.modified,b)}else b.a.type==action.ACTION_TYPES.gather?AI.searchForNewResources(a,b,b.a.info):(b.a.type==action.ACTION_TYPES.move||b.a.type==action.ACTION_TYPES.patrol)&&order.goToElementNextOrder(a,b)}},gameLogic.removeDeads=function(a){for(var b in a.gameElements.unit){var c=a.gameElements.unit[b];c.l<=0&&(production.removeUnit(a,c),gameCreation.removeGameElement(a,c),delete a.gameElements.unit[c.id])}},gameLogic.updateBuildings=function(a,b){b.q.length>0&&(production.updateQueueProgress(a,b),tools.addUniqueElementToArray(a.modified,b))},gameLogic.checkGameOver=function(a){var b=-1,c=0;for(var d in a.players)a.players[d].s==gameData.PLAYER_STATUSES.defeat||a.players[d].s==gameData.PLAYER_STATUSES.surrender?c++:b=a.players[d].o;c==a.players.length-1&&(a.players[b].s=gameData.PLAYER_STATUSES.victory)},gameLogic.protectAround=function(a,b){var c=tools.getElementData(b);(null==b.a||b.a.type==action.ACTION_TYPES.move&&b.a.info==order.SPECIAL_ORDERS.attack)&&!c.isBuilder&&(b.f==gameData.FAMILIES.unit||b.cp>=100&&null!=c.attack)&&AI.searchForNewEnemy(a,b)};var move={};move.ASTAR_MAX_STEPS_SEARCH=4,move.DESTINATION_SEARCH_NUMBER=5,move.ASTAR_MAX_RADIUS_SEARCH=10,move.moveElement=function(a,b,c){var d=tools.getElementData(b);if(b.fl=gameData.ELEMENTS_FLAGS.moving,a.iterate%accessors.getStat(a.players,b.o,d,fightLogic.STATS_BUFF.speed)==0){var e=d.passiveSkill[fightLogic.PASSIVE_SKILLS.shootDelay];null!=e&&(e.current=e.delay);var f=0;a:for(;a.grid[c.x][c.y].c>0&&f<this.DESTINATION_SEARCH_NUMBER;){f++;var g=astar.neighbors(a.grid,c.x,c.y,!0);for(var h in g)if(0==g[h].c){c=g[h],b.a.moveTo={x:c.x,y:c.y};break a}c={x:g[1].x,y:g[1].y}}if(c.c>0)return b.a.moveTo=null,void(b.fl=gameData.ELEMENTS_FLAGS.nothing);var i=astar.search(a.grid,b.p,a.grid[c.x][c.y],!0);if(i.length>0){var j=d.shape;for(var h in j)for(var k in j[h])if(j[h][k]>0){var l=tools.getPartPosition(b,h,k);a.grid[l.x][l.y].c=0}b.p.x=i[0].x,b.p.y=i[0].y;for(var h in j)for(var k in j[h])if(j[h][k]>0){var l=tools.getPartPosition(b,h,k);a.grid[l.x][l.y].c=b.id}b.a.moveTo.x==b.p.x&&b.a.moveTo.y==b.p.y&&(b.a.type==action.ACTION_TYPES.move?(b.a=null,b.fl=gameData.ELEMENTS_FLAGS.nothing,b.pa.length>0&&order.goToElementNextOrder(a,b)):(b.a.moveTo=null,b.fl=gameData.ELEMENTS_FLAGS.nothing))}}};var astar={init:function(a,b,c){for(var d=Math.max(0,Math.min(b.x,c.x)-move.ASTAR_MAX_RADIUS_SEARCH),e=Math.min(a[0].length,Math.max(b.x,c.x)+move.ASTAR_MAX_RADIUS_SEARCH),f=Math.max(0,Math.min(b.y,c.y)-move.ASTAR_MAX_RADIUS_SEARCH),g=Math.min(a.length,Math.max(b.y,c.y)+move.ASTAR_MAX_RADIUS_SEARCH),h=d;e>h;h++)for(var i=f;g>i;i++){var j=a[h][i];j.f=0,j.g=0,j.h=0,j.cost=1,j.visited=!1,j.closed=!1,j.parent=null}},heap:function(){return new BinaryHeap(function(a){return a.f})},search:function(a,b,c,d,e){astar.init(a,b,c),e=e||astar.manhattan,d=!!d;var f=astar.heap();for(f.push(a[b.x][b.y]);f.size()>0;){var g=f.pop();if(g===c||f.size()>this.ASTAR_MAX_STEPS_SEARCH){for(var h=g,i=[];h.parent;)i.push(h),h=h.parent;return i.reverse()}g.closed=!0;for(var j=astar.neighbors(a,g.x,g.y,d),k=0,l=j.length;l>k;k++){var m=j[k];if(!(m.closed||m.c>0)){var n=g.g+m.cost,o=m.visited;(!o||n<m.g)&&(m.visited=!0,m.parent=g,m.h=m.h||e(m,c),m.g=n,m.f=m.g+m.h,o?f.rescoreElement(m):f.push(m))}}}return[]},manhattan:function(a,b){var c=Math.abs(b.x-a.x),d=Math.abs(b.y-a.y);return c+d},neighbors:function(a,b,c,d){var e=[];return a[b-1]&&a[b-1][c]&&e.push(a[b-1][c]),a[b+1]&&a[b+1][c]&&e.push(a[b+1][c]),a[b]&&a[b][c-1]&&e.push(a[b][c-1]),a[b]&&a[b][c+1]&&e.push(a[b][c+1]),d&&(a[b-1]&&a[b-1][c-1]&&e.push(a[b-1][c-1]),a[b+1]&&a[b+1][c-1]&&e.push(a[b+1][c-1]),a[b-1]&&a[b-1][c+1]&&e.push(a[b-1][c+1]),a[b+1]&&a[b+1][c+1]&&e.push(a[b+1][c+1])),e}};BinaryHeap.prototype={push:function(a){this.content.push(a),this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a},remove:function(a){for(var b=this.content.length,c=0;b>c;c++)if(this.content[c]==a){var d=this.content.pop();return void(c!=b-1&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.sinkDown(c):this.bubbleUp(c)))}throw new Error("Node not found.")},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},sinkDown:function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},bubbleUp:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=null;if(b>f){var h=this.content[f],i=this.scoreFunction(h);d>i&&(g=f)}if(b>e){var j=this.content[e],k=this.scoreFunction(j);(null==g?d:i)>k&&(g=e)}if(null==g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}}};var order={};order.TYPES={action:0,buildThatHere:1,buy:2,cancelConstruction:3,chat:4,diplomacy:5,surrender:6,stop:7,hold:8,cancelQueue:9},order.SPECIAL_ORDERS={normal:0,attack:1,patrol:2},order.dispatchReceivedOrder=function(a,b,c){switch(b){case 0:this.convertDestinationToOrder(a,c[0],c[1],c[2],c[3],c[4]);break;case 1:this.buildThatHere(a,c[0],c[1],c[2],c[3],c[4]);break;case 2:this.buy(a,c[0],c[1]);break;case 3:this.cancelConstruction(a,c[0]);break;case 4:this.receiveChatMessage(a,c[0],c[1]);break;case 5:this.updateDiplomacy(a,c[0],c[1],c[2]);break;case 6:this.surrender(a,c[0]);break;case 7:this.stopUnits(a,c[0]);break;case 8:this.holdUnits(a,c[0]);break;case 9:this.cancelQueue(a,c[0],c[1])}},order.buildThatHere=function(a,b,c,d,e,f){var g=tools.getGameElementsFromIds(a,b),c=new gameData.Building(c,d,e,g[0].o,!1);production.startConstruction(a,c),this.build(a,g,c,f)},order.buy=function(a,b,c){var d=tools.getGameElementsFromIds(a,b);production.buyElement(a,d,c)},order.cancelConstruction=function(a,b){var c=tools.getGameElementsFromIds(a,[b]);production.cancelConstruction(a,c[0])},order.cancelQueue=function(a,b,c){var d=tools.getGameElementsFromIds(a,[b]);a.cancel.push({building:d[0],index:c})},order.updateRallyingPoint=function(a,b,c,d){for(var e in b){var f=b[e],g=tools.getElementData(f),h=g.buttons;h.length>0&&(f.rp={x:c,y:d}),tools.addUniqueElementToArray(a.modified,f)}},order.attack=function(a,b,c){for(var d in b){var e=b[d];e.a=new gameData.Order(action.ACTION_TYPES.attack,null,c.id),e.pa=[],tools.addUniqueElementToArray(a.modified,e)}},order.build=function(a,b,c,d){for(var e in b){var f=b[e];d&&null!=f.a&&f.a.type!=action.ACTION_TYPES.gather?f.pa.push(new gameData.Order(action.ACTION_TYPES.build,null,c.id)):(f.a=new gameData.Order(action.ACTION_TYPES.build,null,c.id),f.pa=[]),tools.addUniqueElementToArray(a.modified,f)}},order.move=function(a,b,c,d,e,f){for(var g in b){var h=b[g];e&&null!=h.a&&h.a.type!=action.ACTION_TYPES.gather?h.pa.push(new gameData.Order(action.ACTION_TYPES.move,{x:c,y:d},null,f)):(h.a=new gameData.Order(action.ACTION_TYPES.move,{x:c,y:d},null,f),h.pa=[],f==order.SPECIAL_ORDERS.patrol&&h.pa.push(new gameData.Order(action.ACTION_TYPES.move,{x:h.p.x,y:h.p.y},null,2))),tools.addUniqueElementToArray(a.modified,h)}},order.gather=function(a,b,c,d){var e=tools.getElementData(c);for(var f in b){var g=b[f];d&&null!=g.a&&g.a.type!=action.ACTION_TYPES.gather?g.pa.push(new gameData.Order(action.ACTION_TYPES.gather,null,c.id,e.resourceType)):(g.a=new gameData.Order(action.ACTION_TYPES.gather,null,c.id,e.resourceType),g.pa=[g.a]),tools.addUniqueElementToArray(a.modified,g)}},order.receiveChatMessage=function(a,b,c){a.chat.push({o:b,text:c})},order.updateDiplomacy=function(a,b,c,d){a.players[b].ra[c]=d},order.surrender=function(a,b){a.players[b].s=gameData.PLAYER_STATUSES.surrender},order.convertDestinationToOrder=function(a,b,c,d,e,f){var g=tools.getGameElementsFromIds(a,b);if(0==g.length||null==a.grid[c]||null==a.grid[c][d])return void console.log(c+" "+d);var h=null,i=a.grid[c][d].c;if(i>0&&(h=tools.getGameElementsFromIds(a,[i])),g[0].f==gameData.FAMILIES.building)this.updateRallyingPoint(a,g,c,d);else{if(null!=h&&h.length>0){var j=tools.getElementData(h[0]);if(h[0].f==gameData.FAMILIES.unit){if(!rank.isAlly(a.players,g[0].o,h[0]))return void this.attack(a,g,h[0])}else{if(h[0].f==gameData.FAMILIES.building){if(rank.isAlly(a.players,g[0].o,h[0])){for(var k in g){var l=g[k];tools.getElementData(l).isBuilder?order.build(a,[l],h[0],e):order.move(a,[l],c,d,e,f)}return}return void order.attack(a,g,h[0])}if(h[0].f==gameData.FAMILIES.land&&j.resourceType>=0){for(var k in g){var l=g[k];tools.getElementData(l).isBuilder?order.gather(a,[l],h[0],e):order.move(a,[l],c,d,e,f)}return}}}order.move(a,g,c,d,e,f)}},order.goToElementNextOrder=function(a,b){if(b.pa.length>0){if(null!=b.a&&b.a.type==action.ACTION_TYPES.gather)return;if(null!=b.a&&b.a.type==action.ACTION_TYPES.build){var c=tools.getElementById(a,b.a.id),d=tools.getElementData(c);if(c.cp<100||c.l<d.l)return}else b.pa[0].type==action.ACTION_TYPES.move&&b.pa[0].info==order.SPECIAL_ORDERS.patrol&&1==b.pa.length&&(b.pa.push(new gameData.Order(action.ACTION_TYPES.move,{x:b.p.x,y:b.p.y},null,order.SPECIAL_ORDERS.patrol)),b.pa.push(new gameData.Order(action.ACTION_TYPES.move,{x:b.pa[0].moveTo.x,y:b.pa[0].moveTo.y},null,order.SPECIAL_ORDERS.patrol)));b.a=b.pa[0],b.pa.splice(0,1)}else b.a=null,b.fl=gameData.ELEMENTS_FLAGS.nothing},order.stopUnits=function(a,b){var c=tools.getGameElementsFromIds(a,b);for(var d in c){var e=c[d];e.f==gameData.FAMILIES.unit&&(e.a=null,e.pa=[],e.fl=gameData.ELEMENTS_FLAGS.nothing,tools.addUniqueElementToArray(a.modified,e))}},order.holdUnits=function(a,b){var c=tools.getGameElementsFromIds(a,b);for(var d in c){var e=c[d];e.f==gameData.FAMILIES.unit&&(e.a=new gameData.Order(action.ACTION_TYPES.hold,null,null),e.pa=[],e.fl=gameData.ELEMENTS_FLAGS.nothing,tools.addUniqueElementToArray(a.modified,e))}};var production={};production.RESOURCE_AMOUNT_PER_GATHERING_ACTION=1,production.BUILDINGS_QUEUE_MAX_SIZE=5,production.REPAIRING_SPEED=5,production.startConstruction=function(a,b){var c=tools.getElementData(b);this.canBuyIt(a.players,b.o,c)&&(this.paysForElement(a,b.o,c),a.newBuildings.push(b))},production.updateConstruction=function(a,b){var c=tools.getElementData(b);b.cp+=100/c.timeConstruction,b.l+=parseInt(c.l/c.timeConstruction),b.l=Math.min(c.l,b.l),b.cp>=100&&this.finishConstruction(a,b),tools.addUniqueElementToArray(a.modified,b)},production.cancelConstruction=function(a,b){if(null!=b&&b.cp<95){var c=tools.getElementData(b);this.sellsElement(a,b.o,c),this.removeBuilding(a,b);for(var d in a.gameElements.unit)null!=a.gameElements.unit[d].a&&a.gameElements.unit[d].a.id==b.id&&order.goToElementNextOrder(a,a.gameElements.unit[d]);a.cancelBuildings.push(b),delete a.gameElements.building[b.id]}},production.cancel=function(a,b,c){var d=null;b.q[c]>=0?d=gameData.FAMILIES.unit:(d=gameData.FAMILIES.research,a.players[b.o].tecC.splice(a.players[b.o].tecC.indexOf(c))),this.sellsElement(a,b.o,tools.getElementDataFrom(d,b.r,b.q[c])),b.q.splice(c,1),0==c&&(b.qp=0),tools.addUniqueElementToArray(a.modified,b)},production.finishConstruction=function(a,b){var c=tools.getElementData(b);b.cp=100,b.l=c.l,a.players[b.o].tec.push(c.key),c.pop>0&&(a.players[b.o].pop.max+=c.pop),stats.updateField(a,b.o,"buildingsCreated",1)},production.repairBuilding=function(a,b){var c=a.players[b.o].re;c[gameData.RESOURCES.wood.id]>0&&c[gameData.RESOURCES.gold.id]>0&&(c[gameData.RESOURCES.gold.id]--,c[gameData.RESOURCES.wood.id]--,b.l+=this.REPAIRING_SPEED,b.l=Math.min(b.l,tools.getElementData(b).l),tools.addUniqueElementToArray(a.modified,b))},production.removeBuilding=function(a,b){var c=tools.getElementData(b);c.pop>0&&100==b.cp&&(a.players[b.o].pop.max-=c.pop,a.players[b.o].tec.splice(a.players[b.o].tec.indexOf(c.key)));for(var d in b.q)this.cancel(a,b,d);null!=b.murderer&&stats.updateField(a,b.murderer,"buildingsDestroyed",1)},production.gatherResources=function(a,b,c){var d=tools.getElementData(c),e=tools.getElementData(b);(null==b.ga||b.ga.t!=d.resourceType)&&(b.ga={t:d.resourceType,amount:0});var f=Math.min(e.maxGathering-b.ga.amount,this.RESOURCE_AMOUNT_PER_GATHERING_ACTION,c.ra);if(b.ga.amount+=f,c.ra-=f,tools.addUniqueElementToArray(a.modified,c),b.ga.amount==e.maxGathering){var g=tools.getNearestStuff(a,b,gameData.FAMILIES.building,gameData.ELEMENTS[gameData.FAMILIES.building][b.r].hq.t,gameData.RANKS.me,!0);null!=g?(b.a=new gameData.Order(action.ACTION_TYPES.gather,null,g.id,d.resourceType),b.pa=[new gameData.Order(action.ACTION_TYPES.gather,null,c.id,d.resourceType)]):(b.a=null,b.pa=[])}c.ra<=0&&(gameCreation.removeGameElement(a,c),delete a.gameElements.land[c.id],AI.searchForNewResources(a,b,d.resourceType))},production.getBackResources=function(a,b){var c=b.ga.t;if(a.players[b.o].re[b.ga.t]+=b.ga.amount,stats.updateField(a,b.o,"resources",b.ga.amount),b.ga=null,b.pa.length>0&&b.pa[0].type==action.ACTION_TYPES.gather){var d=tools.getElementById(a,b.pa[0].id);null==d||d.ra<=0?AI.searchForNewResources(a,b,c):b.a=b.pa[0]}b.pa=[]},production.buyElement=function(a,b,c){for(var d in b){var e=b[d];if(e.t==b[0].t&&100==e.cp&&e.q.length<this.BUILDINGS_QUEUE_MAX_SIZE&&this.canBuyIt(a.players,e.o,c)&&(this.paysForElement(a,e.o,c),e.q.push(c.t),tools.addUniqueElementToArray(a.modified,e),!(c.t>=0)))return void a.players[e.o].tecC.push(c.t)}},production.updateQueueProgress=function(a,b){var c;if(c=b.q[0]>=0?tools.getElementDataFrom(gameData.FAMILIES.unit,b.r,b.q[0]):tools.getElementDataFrom(gameData.FAMILIES.research,b.r,b.q[0]),b.qp+=Math.max(1,parseInt(100/(gameLogic.FREQUENCY*c.timeConstruction))),b.qp>=100){var d=!0;b.q[0]>=0?d=this.createNewUnit(a,b.q[0],b):(d=!0,a.players[b.o].tec.push(b.q[0]),a.players[b.o].tecC.splice(a.players[b.o].tecC.indexOf(b.q[0]))),d?(b.qp=0,b.q.splice(0,1)):b.qp=99}tools.addUniqueElementToArray(a.modified,b)},production.createNewUnit=function(a,b,c){var d=tools.getElementDataFrom(gameData.FAMILIES.unit,c.r,b),e=tools.getFreeTilesAroundElements(a,c),f=a.players[c.o].pop;if(e.length>0&&f.current+d.pop<=f.max){d.isBuilder?stats.updateField(a,c.o,"buildersCreated",1):stats.updateField(a,c.o,"unitsCreated",1);var g=e[e.length-1],h=new gameData.Unit(d,g.x,g.y,c.o);return a.players[c.o].pop.current+=d.pop,gameCreation.addGameElement(a,h),null!=c.rp&&order.convertDestinationToOrder(a,[h.id],c.rp.x,c.rp.y),!0}return!1},production.removeUnit=function(a,b){var c=tools.getElementData(b);c.pop>0&&(a.players[b.o].pop.current-=c.pop),null!=b.murderer&&(stats.updateField(a,b.murderer,"killed",1),stats.updateField(a,b.o,"lost",1))},production.canBuyIt=function(a,b,c){for(var d in c.needs){var e=c.needs[d];if(e.t>=0){if(e.value>a[b].re[e.t])return!1}else if(-1==a[b].tec.indexOf(e.t))return!1}return!0},production.paysForElement=function(a,b,c){for(var d in c.needs){var e=c.needs[d];e.t>=0&&(a.players[b].re[e.t]-=e.value)}},production.sellsElement=function(a,b,c){if(null!=c)for(var d in c.needs){var e=c.needs[d];e.t>=0&&(a.players[b].re[e.t]+=parseInt(e.value/2))}},production.getWhatCanBeBought=function(a,b,c){var d=[];for(var e in c){var f=c[e];(f.t>=0||-1==a[b].tec.indexOf(f.t)&&-1==a[b].tecC.indexOf(f.t))&&(f.isEnabled=this.canBuyIt(a,b,f),f.id=""+f.f+f.r+f.t,d.push(f))}return null!=c.house&&d.splice(0,0,gameData.BUTTONS.back),d};var rank={};rank.isEnemy=function(a,b,c){return a[b].ra[c.o]==gameData.RANKS.enemy?!0:!1},rank.canBeAttacked=function(a,b,c){return a[b].ra[c.o]==gameData.RANKS.enemy||a[b].ra[c.o]==gameData.RANKS.neutral?!0:!1},rank.isAlly=function(a,b,c){return a[b].ra[c.o]==gameData.RANKS.me||a[b].ra[c.o]==gameData.RANKS.ally?!0:!1};var stats={};stats.UPDATE_FREQUENCY=100,stats.init=function(a){for(var b in a.players)a.stats.push({pop:[],killed:0,lost:0,buildingsDestroyed:0,unitsCreated:0,resources:0,buildersCreated:0,buildingsCreated:0})},stats.update=function(a){if(a.iterate%this.UPDATE_FREQUENCY==0)for(var b in a.players)a.stats[b].pop.push([(new Date).getTime(),a.players[b].pop.current])},stats.updateField=function(a,b,c,d){a.stats[b][c]+=d},stats.getTotalScore=function(a,b){return 20*a.killed-20*a.lost+100*a.buildingsDestroyed+10*a.unitsCreated+a.resources+5*a.buildersCreated+20*a.buildingsCreated+500*b};var tools={};tools.getPositionsDistance=function(a,b){return Math.max(Math.abs(a.x-b.x),Math.abs(a.y-b.y))},tools.getElementsDistance=function(a,b){var c=1e4;if(null!=b){var d=tools.getElementData(b),e=d.shape;for(var f in e)for(var g in e[f]){var h=this.getPositionsDistance(a.p,this.getPartPosition(b,f,g));if(c>h&&(c=h),1==c)return c}}return c},tools.getClosestPart=function(a,b){var c,d=1e4,e=tools.getElementData(b),f=e.shape;for(var g in f)for(var h in f[g]){var i=this.getPositionsDistance(a.p,this.getPartPosition(b,g,h));if(d>i&&(d=i,c=this.getPartPosition(b,g,h)),1==d)return c}return c},tools.getPartPosition=function(a,b,c){var d=null;if(null==a.shape){var e=tools.getElementData(a);d=e.shape}else d=a.shape;return{x:parseInt(a.p.x+parseInt(b)-parseInt(d[0].length/2)),y:parseInt(a.p.y+parseInt(c)-parseInt(d.length/2))}},tools.getFreeTilesAroundElements=function(a,b){var c=[],d=tools.getElementData(b),e=d.shape;for(var f in e)for(var g in e[f])if(e[f][g]>0){var h=this.getPartPosition(b,f,g),i=this.getNeighbors(a.grid,h.x,h.y);
for(var j in i){var k=i[j];0==a.grid[k.x][k.y].c&&c.push({x:k.x,y:k.y})}}return c},tools.getNeighbors=function(a,b,c){var d=[];return a[b-1]&&null!=a[b-1][c]&&d.push({x:b-1,y:c}),a[b+1]&&null!=a[b+1][c]&&d.push({x:b+1,y:c}),a[b]&&null!=a[b][c-1]&&d.push({x:b,y:c-1}),a[b]&&null!=a[b][c+1]&&d.push({x:b,y:c+1}),a[b-1]&&null!=a[b-1][c-1]&&d.push({x:b-1,y:c-1}),a[b+1]&&null!=a[b+1][c-1]&&d.push({x:b+1,y:c-1}),a[b-1]&&null!=a[b-1][c+1]&&d.push({x:b-1,y:c+1}),a[b+1]&&null!=a[b+1][c+1]&&d.push({x:b+1,y:c+1}),d},tools.getGameElementsFromIds=function(a,b){var c=[];for(var d in b)c.push(a.gameElements[Object.keys(gameData.FAMILIES)[(""+b[d]).charAt(1)]][b[d]]);return c},tools.addUniqueElementToArray=function(a,b){var c=a.indexOf(b);-1==c&&a.push(b)},tools.clone=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&"a"!=c&&(b[c]=a[c]);return b},tools.getNearestStuff=function(a,b,c,d,e,f){var g=null;if(f){var h=1e3;for(var i in a.gameElements[Object.keys(gameData.FAMILIES)[c]]){var j=a.gameElements[Object.keys(gameData.FAMILIES)[c]][i];if(!(null!=d&&j.t!=d||null!=e&&a.players[b.o].ra[j.o]!=e)){var k=this.getElementsDistance(b,j);if(h>k&&(h=k,g=j,4>h))return g}}}else{var k=0,l=tools.getElementData(b);do k++,g=tools.searchInTiles(a,this.getTilesAround(a.grid,b.p,k,!1),b,c,d,e);while(null==g&&k<l.vision)}return g},tools.getTilesAround=function(a,b,c,d){for(var e=[],f=b.x-c;f<=b.x+c;f++)if(null!=a[f])if(d||f==b.x-c||f==b.x+c)for(var g=b.y-c;g<=b.y+c;g++)a[f][g]&&e.push(a[f][g]);else a[f][b.y-c]?e.push(a[f][b.y-c]):a[f][b.y+c]&&e.push(a[f][b.y+c]);return e},tools.searchInTiles=function(a,b,c,d,e,f){for(var g in b)if(b[g].c>0){var h=a.gameElements[Object.keys(gameData.FAMILIES)[d]][b[g].c];if(!(null==h||h.f!=d||null!=e&&h.t!=e||null!=f&&a.players[c.o].ra[h.o]!=f))return h}return null},tools.getElementById=function(a,b){return a.gameElements[Object.keys(gameData.FAMILIES)[(""+b)[1]]][b]},tools.getElementData=function(a){if(a.t>=0){var b=gameData.ELEMENTS[a.f][a.r];return b[Object.keys(b)[a.t]]}return gameData.ELEMENTS[a.f][a.r][a.t]},tools.getElementDataFrom=function(a,b,c){var d=gameData.ELEMENTS[a][b];return c>=0?d[Object.keys(d)[c]]:d[c]};var aiOrders={};aiOrders.update=function(a,b){var c=b.o;this.buildHouses(a,b,c),this.harvest(a,b,c),this.trainHarvesters(a,c),this.trainSoldiers(a,b,c);var d=!1,e=0;for(var f in a.buildings){var g=a.buildings[f];g.o==b.o&&(g.t==gameData.ELEMENTS[gameData.FAMILIES.building][b.r].hq.t?d=!0:g.t==gameData.ELEMENTS[gameData.FAMILIES.building][b.r].casern.t&&e++)}this.buildRax(a,b,c,e),this.finishBuildings(a,c),this.buildTownHall(a,b,c,d),this.shoudIAttack(a,c)},aiOrders.buildRax=function(a,b,c,d){var e=gameData.ELEMENTS[gameData.FAMILIES.building][b.r].casern;if(production.canBuyIt(a.players,c,e)){var f=null,g=0;for(var g in a.gameElements.unit){var h=a.gameElements.unit[g];this.isHarvestingOrIdleWorker(h,c)&&(f=h)}if(null==f)return;for(var i=f.p,j=0,j=0;10>j;j++){i=f.p,order.move(a,[f],parseInt(Math.random()*a.grid[0].length-1),parseInt(Math.random()*a.grid.length-1),!0);var k=tools.getFreeTilesAroundElements(a,f);for(var g in k){var l=tools.getNeighbors(a.grid,i.x,i.y);for(var m in l)i=l[m],this.canBeBuiltHere(a,i,e)&&(d>0&&Math.random()<.5?order.buildThatHere(a,[f.id],gameData.ELEMENTS[gameData.FAMILIES.building][b.r].tower,i.x,i.y,!0):order.buildThatHere(a,[f.id],e,i.x,i.y,!0))}}}},aiOrders.buildTownHall=function(a,b,c,d){var e=gameData.ELEMENTS[gameData.FAMILIES.building][b.r].hq;if(production.canBuyIt(a.players,c,e)&&(b.pop.current>20||!d)){var f=null,g=0;for(var g in a.gameElements.unit){var h=a.gameElements.unit[g];(this.isHarvestingOrIdleWorker(h,c)||!d)&&(f=h)}if(null==f)return;for(var i=f.p,j=0,j=0;10>j;j++){i=f.p,order.move(a,[f],parseInt(Math.random()*a.grid[0].length-1),parseInt(Math.random()*a.grid.length-1),!0);var k=tools.getFreeTilesAroundElements(a,f);for(var g in k){var l=tools.getNeighbors(a.grid,i.x,i.y);for(var m in l)i=l[m],this.canBeBuiltHere(a,i,e)&&order.buildThatHere(a,[f.id],e,i.x,i.y,!0)}}}},aiOrders.buildHouses=function(a,b,c){var d=gameData.ELEMENTS[gameData.FAMILIES.building][b.r].house;if(production.canBuyIt(a.players,c,d)&&b.pop.current>b.pop.max-3){var e=null,f=0;for(var f in a.gameElements.unit){var g=a.gameElements.unit[f];this.isHarvestingOrIdleWorker(g,c)&&(e=g)}if(null==e)return;for(var h=e.p,i=0,i=0;10>i;i++){order.move(a,[e],parseInt(Math.random()*a.grid[0].length-1),parseInt(Math.random()*a.grid.length-1),!1);var j=tools.getFreeTilesAroundElements(a,e);for(var f in j){h=j[f];var k=tools.getNeighbors(a.grid,h.x,h.y);for(var l in k)if(h=k[l],this.canBeBuiltHere(a,h,d))return void order.buildThatHere(a,[e.id],d,h.x,h.y,!1)}}}},aiOrders.finishBuildings=function(a,b){for(var c in a.gameElements.building){var d=a.gameElements.building[c];if(d.o==b&&d.cp<100){var e=null,f=0;for(var f in a.gameElements.unit){var g=a.gameElements.unit[f];this.isIdleWorker(g,b)&&(e=g)}if(null==e)return;return void order.build(a,[e],d,!1)}}},aiOrders.trainHarvesters=function(a,b){for(var c in a.gameElements.building){var d=a.gameElements.building[c];d.o==b&&d.t==gameData.ELEMENTS[d.f][d.r].hq.t&&d.q.length<2&&order.buy(a,[d.id],gameData.ELEMENTS[gameData.FAMILIES.unit][d.r].builder)}},aiOrders.trainSoldiers=function(a,b,c){for(var d in a.gameElements.building){var e=a.gameElements.building[d];e.o==c&&e.t==gameData.ELEMENTS[gameData.FAMILIES.building][e.r].casern.t&&e.q.length<2&&(b.re[1]<200?order.buy(a,[e.id],gameData.ELEMENTS[gameData.FAMILIES.unit][e.r].baseUnit2):order.buy(a,[e.id],gameData.ELEMENTS[gameData.FAMILIES.unit][e.r].baseUnit1))}},aiOrders.harvest=function(a,b,c){var d=[];for(var e in a.gameElements.unit){var f=a.gameElements.unit[e];this.isIdleWorker(f,c)&&d.push(f)}for(var g in d)if(b.re[0]<=b.re[1]||b.re[0]<100&&b.re[1]>80||b.re[0]<50){var h=tools.getNearestStuff(a,d[g],gameData.FAMILIES.land,gameData.RESOURCES.gold.id,null,!0);null!=h&&order.gather(a,[d[g]],tools.getNearestStuff(a,d[g],gameData.FAMILIES.land,gameData.RESOURCES.gold.id,null,!0),!0)}else{var h=tools.getNearestStuff(a,d[g],gameData.FAMILIES.land,gameData.RESOURCES.wood.id,null,!0);null!=h&&order.gather(a,[d[g]],tools.getNearestStuff(a,d[g],gameData.FAMILIES.land,gameData.RESOURCES.wood.id,null,!0),!0)}},aiOrders.canBeBuiltHere=function(a,b,c){c.p=b;for(var d=tools.getPartPosition(c,0,0),e={x:d.x+c.shape[0].length-1,y:d.y+c.shape.length-1},f=d.x;f<=e.x;f++)for(var g=d.y;g<=e.y;g++)if(0==f||0==g||null==a.grid[f]||null==a.grid[f][g]||f==a.grid[0].length-1||g==a.grid.length-1||a.grid[f][g].c>0)return!1;return!0},aiOrders.isIdleWorker=function(a,b){var c=tools.getElementData(a);return a.o==b&&c.isBuilder&&null==a.a&&0==a.pa.length?!0:!1},aiOrders.isHarvestingOrIdleWorker=function(a,b){var c=tools.getElementData(a);return a.o!=b||!c.isBuilder||null!=a.a&&a.a.type!=action.ACTION_TYPES.gather?!1:!0},aiOrders.shoudIAttack=function(a,b){var c=[],d=0;for(var d in a.gameElements.unit){var e=a.gameElements.unit[d],f=tools.getElementData(e);e.o!=b||f.isBuilder||c.push(e)}if(c.length>10){for(var g in a.gameElements.unit){var e=a.gameElements.unit[g],f=tools.getElementData(e);if(e.o!=b&&!f.isBuilder)try{return void order.attack(a,c,e)}catch(h){console.log("Attack failed. Error: "+h)}}for(var g in a.gameElements.unit){var e=a.gameElements.unit[g],f=tools.getElementData(e);if(e.o!=b&&!f.isBuilder)try{return void order.attack(a,c,e)}catch(h){console.log("Attack failed. Error: "+h)}}for(var g in a.gameElements.building){var i=a.gameElements.building[g];if(i.o!=b)try{return void order.attack(a,c,i)}catch(h){console.log("Attack failed. Error: "+h)}}}};var accessors={};accessors.getStat=function(a,b,c,d){var e=null;switch(d){case fightLogic.STATS_BUFF.attack:e=c.attack;break;case fightLogic.STATS_BUFF.defense:e=c.defense;break;case fightLogic.STATS_BUFF.attackSpeed:e=c.attackSpeed;break;case fightLogic.STATS_BUFF.speed:e=c.speed;break;case fightLogic.STATS_BUFF.range:e=c.range;break;case fightLogic.STATS_BUFF.vision:e=c.vision}for(var f in c.techs){var g=c.techs[f],h=gameData.ELEMENTS[gameData.FAMILIES.research][a[b].r][g];for(var i in h.addStats)h.addStats[i].stat==d&&a[b].tec.indexOf(g)>=0&&(e+=parseInt(h.addStats[i].value))}return e},gameData.RACES={human:{id:0,name:"Human Alliance",image:"human.png"}},gameData.RESOURCES={gold:{id:0,name:"Gold",image:"ic_gold"},wood:{id:1,name:"Wood",image:"ic_wood"}},gameData.VICTORY_CONDITIONS={annihilation:{id:0,name:"Annihilation",description:"Destroy all the enemies' buildings"}},gameData.TO_CLIENT_SOCKET={listJoinableGames:0,updateLoadingProgress:1,gameStart:2,rejoin:3,login:4,updateQueue:5,gameData:10,gameStats:11},gameData.TO_SERVER_SOCKET={login:0,createNewGame:1,enterSalon:2,leaveSalon:3,joinGame:4,updateLoadingProgress:5,rejoinGame:6,sendOrder:10},gameData.DEFAULT_NAMES=["Colonel Heinz","Juice Master","Lord Bobby","Lemon Alisa","The Red Baron","Tom Boy","Tommy Toe","Lee Mon","Sigmund Fruit","Al Pacho","Mister Bean","Ban Anna","General Grape","Smoothie","Optimus Lime"],gameData.getRandomName=function(){return this.DEFAULT_NAMES[parseInt(Math.random()*this.DEFAULT_NAMES.length)]},gameData.BUTTONS={build:{id:"build",tooltip:"Build (B)",shortcut:66,g:"ic_build",isEnabled:!0},back:{id:"back",tooltip:"Back (B)",shortcut:66,g:"ic_back",isEnabled:!0},cancel:{id:"cancel",tooltip:"Cancel (C)",shortcut:67,g:"ic_cancel",isEnabled:!0}},gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id]={bastardsword:{f:gameData.FAMILIES.research,r:gameData.RACES.human.id,t:"bastardsword",tooltip:"Bastard Sword (S)<p>+ 5 Atk to Swordsmen</p>",timeConstruction:15,needs:[{t:gameData.RESOURCES.gold.id,value:100},{t:gameData.RESOURCES.wood.id,value:80}],g:"bastardsword",addPassiveSkills:[],addStats:[{stat:fightLogic.STATS_BUFF.attack,value:5}],shortcut:83},leatherarmor:{f:gameData.FAMILIES.research,r:gameData.RACES.human.id,t:"leatherarmor",tooltip:"Leather Armor (A)<p>+ 5 Def to Swordsmen</p>",timeConstruction:20,needs:[{t:gameData.RESOURCES.gold.id,value:150},{t:gameData.RESOURCES.wood.id,value:100}],g:"leatherarmor",addPassiveSkills:[],addStats:[{stat:fightLogic.STATS_BUFF.defense,value:5}],shortcut:65},longbow:{f:gameData.FAMILIES.research,r:gameData.RACES.human.id,t:"longbow",tooltip:"Long Bow (B)<p>+ 5 Range to Bowmen</p>",timeConstruction:20,needs:[{t:gameData.RESOURCES.gold.id,value:100},{t:gameData.RESOURCES.wood.id,value:200}],g:"longbow",addPassiveSkills:[],addStats:[{stat:fightLogic.STATS_BUFF.range,value:5}],shortcut:66},spikedmace:{f:gameData.FAMILIES.research,r:gameData.RACES.human.id,t:"spikedmace",tooltip:"Spiked Mace (M)<p>+ 10 Atk to Knights</p>",timeConstruction:20,needs:[{t:gameData.RESOURCES.gold.id,value:250},{t:gameData.RESOURCES.wood.id,value:200},{t:"factory"}],g:"spikedmace",addPassiveSkills:[],addStats:[{stat:fightLogic.STATS_BUFF.attack,value:10}],shortcut:77}},gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id]={builder:{name:"Builder",tooltip:"Builder (B)",shortcut:66,f:gameData.FAMILIES.unit,r:gameData.RACES.human.id,t:0,shape:[[1]],speed:1,isBuilder:!0,buttons:[gameData.BUTTONS.build],timeConstruction:10,l:40,attackSpeed:1,attack:5,defense:0,weaponType:fightLogic.WEAPON_TYPES.normal,armorType:fightLogic.ARMOR_TYPES.unarmored,gatheringSpeed:1,maxGathering:10,pop:1,needs:[{t:gameData.RESOURCES.gold.id,value:50}],g:"builder",gui:"ic_builder.png",height:6,range:1,vision:12,lifeBarWidth:8,techs:[],passiveSkill:{}},baseUnit1:{name:"Swordsman",tooltip:"Swordsman (S)",shortcut:83,f:gameData.FAMILIES.unit,r:gameData.RACES.human.id,t:1,shape:[[1]],speed:1,isBuilder:!1,buttons:[],timeConstruction:15,l:80,attackSpeed:1,attack:10,defense:2,weaponType:fightLogic.WEAPON_TYPES.normal,armorType:fightLogic.ARMOR_TYPES.medium,pop:1,needs:[{t:gameData.RESOURCES.gold.id,value:75}],g:"swordsman",gui:"ic_swordsman.png",height:6,range:1,vision:12,lifeBarWidth:8,passiveSkill:{},techs:[gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].leatherarmor.t,gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].bastardsword.t]},baseUnit2:{name:"Bowman",tooltip:"Bowman (W)",shortcut:87,f:gameData.FAMILIES.unit,r:gameData.RACES.human.id,t:2,shape:[[1]],speed:1,isBuilder:!1,buttons:[],timeConstruction:15,l:50,attackSpeed:1,attack:8,defense:1,weaponType:fightLogic.WEAPON_TYPES.piercing,armorType:fightLogic.ARMOR_TYPES.light,pop:1,needs:[{t:gameData.RESOURCES.gold.id,value:40},{t:gameData.RESOURCES.wood.id,value:60}],g:"bowman",gui:"ic_bowman.png",height:6,range:10,vision:15,lifeBarWidth:8,passiveSkill:{},techs:[gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].longbow.t]},specialUnit1:{name:"Knight",tooltip:"Knight (K)",shortcut:75,f:gameData.FAMILIES.unit,r:gameData.RACES.human.id,t:3,shape:[[1]],speed:2,isBuilder:!1,buttons:[],timeConstruction:15,l:80,attackSpeed:1,attack:25,defense:5,weaponType:fightLogic.WEAPON_TYPES.normal,armorType:fightLogic.ARMOR_TYPES.heavy,pop:2,needs:[{t:gameData.RESOURCES.gold.id,value:150}],g:"knight",gui:"ic_knight.png",height:6,range:1,vision:12,lifeBarWidth:8,passiveSkill:{},techs:[gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].spikedmace.t]}},gameData.ELEMENTS[gameData.FAMILIES.building][gameData.RACES.human.id]={hq:{name:"Town Hall",tooltip:"Town Hall (T)",shortcut:84,f:gameData.FAMILIES.building,r:gameData.RACES.human.id,t:0,shape:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],timeConstruction:80,buttons:[gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].builder],needs:[{t:gameData.RESOURCES.gold.id,value:300},{t:gameData.RESOURCES.wood.id,value:300}],l:500,defense:0,armorType:fightLogic.ARMOR_TYPES.building,pop:8,g:"hq",gui:"ic_hq.png",height:32,vision:15,lifeBarWidth:50,key:"hq",isProduction:!0},house:{name:"House",tooltip:"House (H)",shortcut:72,f:gameData.FAMILIES.building,r:gameData.RACES.human.id,t:1,shape:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],timeConstruction:40,buttons:[],needs:[{t:gameData.RESOURCES.wood.id,value:80}],l:100,defense:0,armorType:fightLogic.ARMOR_TYPES.building,pop:6,g:"house",gui:"ic_house.png",height:16,vision:15,lifeBarWidth:40,key:"house"},casern:{name:"Casern",tooltip:"Casern (C)",shortcut:67,f:gameData.FAMILIES.building,r:gameData.RACES.human.id,t:2,shape:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],timeConstruction:60,buttons:[gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].baseUnit1,gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].baseUnit2],needs:[{t:gameData.RESOURCES.gold.id,value:200},{t:gameData.RESOURCES.wood.id,value:200}],l:250,defense:0,armorType:fightLogic.ARMOR_TYPES.building,pop:0,g:"casern",gui:"ic_casern.png",height:18,vision:15,lifeBarWidth:40,key:"casern",isProduction:!0},researchlab:{name:"Research Lab",tooltip:"Research Lab (R)",shortcut:82,f:gameData.FAMILIES.building,r:gameData.RACES.human.id,t:3,shape:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],timeConstruction:45,buttons:[gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].bastardsword,gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].leatherarmor,gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].longbow,gameData.ELEMENTS[gameData.FAMILIES.research][gameData.RACES.human.id].spikedmace],needs:[{t:gameData.RESOURCES.gold.id,value:100},{t:gameData.RESOURCES.wood.id,value:100},{t:"casern"}],l:200,defense:0,armorType:fightLogic.ARMOR_TYPES.building,pop:0,g:"researchlab",gui:"ic_researchlab.png",height:18,vision:15,lifeBarWidth:40,key:"research lab"},tower:{name:"Defense Tower",tooltip:"Defense Tower (T)",shortcut:84,f:gameData.FAMILIES.building,r:gameData.RACES.human.id,t:4,shape:[[1,1,1],[1,1,1],[1,1,1]],timeConstruction:45,buttons:[],needs:[{t:gameData.RESOURCES.gold.id,value:150},{t:gameData.RESOURCES.wood.id,value:150},{t:"casern"}],l:200,defense:1,armorType:fightLogic.ARMOR_TYPES.building,pop:0,g:"tower",gui:"ic_tower.png",height:25,vision:20,attackSpeed:1,attack:6,weaponType:fightLogic.WEAPON_TYPES.piercing,range:20,lifeBarWidth:30,key:"tower",passiveSkill:{}},factory:{name:"Factory",tooltip:"Factory (F)",shortcut:70,f:gameData.FAMILIES.building,r:gameData.RACES.human.id,t:5,shape:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],timeConstruction:45,buttons:[gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].specialUnit1],needs:[{t:gameData.RESOURCES.gold.id,value:250},{t:gameData.RESOURCES.wood.id,value:250},{t:"research lab"}],l:200,defense:0,armorType:fightLogic.ARMOR_TYPES.building,pop:0,g:"factory",gui:"ic_factory.png",height:18,vision:15,lifeBarWidth:40,key:"factory",isProduction:!0}},gameData.BASECAMPS[gameData.RACES.human.id]={buildings:[gameData.ELEMENTS[gameData.FAMILIES.building][gameData.RACES.human.id].hq],units:[gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].builder,gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].builder,gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].builder,gameData.ELEMENTS[gameData.FAMILIES.unit][gameData.RACES.human.id].builder]},gameData.ELEMENTS[gameData.FAMILIES.land].push({goldmine:{name:"Gold Mine",t:0,shape:[[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],canMoveIn:!1,resourceType:gameData.RESOURCES.gold.id,ra:3e3,g:"goldmine",gui:"ic_goldmine.png",minimapColor:{r:237,g:226,b:117},nbTextures:3},tree:{name:"Tree",t:1,shape:[[1]],canMoveIn:!1,resourceType:gameData.RESOURCES.wood.id,ra:75,g:"tree",gui:"ic_tree.png",minimapColor:{r:52,g:114,b:53},nbTextures:2}}),gameData.ZONES={nothing:0,basecamp:1,forest:2,goldmine:3,highgrass:4,water:5},gameData.MAP_TYPES={random:{id:0,name:"Random"},standard:{id:1,name:"Standard",map:[[1,0,0,2,2,2,0,0,1],[0,3,0,0,2,0,0,3,0],[0,2,0,0,0,0,0,2,0],[2,0,2,0,3,0,2,0,2],[2,0,2,0,2,0,2,0,2],[2,0,2,0,3,0,2,0,2],[0,2,0,2,0,2,0,2,0],[0,2,0,0,0,0,0,2,0],[0,3,0,0,2,0,0,3,0],[1,0,0,2,2,2,0,0,1]]}},gameData.INITIAL_RESOURCES={low:{id:0,name:"Low",re:[{t:gameData.RESOURCES.wood.id,value:100},{t:gameData.RESOURCES.gold.id,value:100}]},standard:{id:1,name:"Standard",re:[{t:gameData.RESOURCES.wood.id,value:150},{t:gameData.RESOURCES.gold.id,value:150}]},high:{id:2,name:"High",re:[{t:gameData.RESOURCES.wood.id,value:300},{t:gameData.RESOURCES.gold.id,value:300}]}},gameData.MAP_SIZES={small:{id:0,name:"Small",x:128,y:128},medium:{id:1,name:"Medium",x:156,y:156},large:{id:2,name:"Large",x:172,y:172}},gameData.VEGETATION_TYPES={standard:{id:0,name:"Standard",zones:[{t:gameData.ZONES.nothing,factor:20},{t:gameData.ZONES.forest,factor:5},{t:gameData.ZONES.goldmine,factor:1}]}};